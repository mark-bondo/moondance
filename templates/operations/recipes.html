{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Recipes</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ag-grid/25.0.0/ag-grid-community.min.js" integrity="sha512-7VPz1NAYcuVu1/eQooUfDUcG2sGRdmy2P9sa6ZgtXOpAVY66bN4u+cDXPcmhrVKA44LdznEEZwMabZ3qO8HB6A==" crossorigin="anonymous"></script>

<style>
body {
    font-family: Helvetica,"Helvetica Neue",Arial,"Lucida Grande",sans-serif;
}
#header, #menu-top {
    background-color: #554e6e;
    margin: -8px
}

#header {
    color: #ffffff;
    padding: 10px 15px 15px 48px;
}

.recipe {
    padding: 15px;
}


.recipe .select2-container{
    width: 550px !important;
}

.ag-header-cell {
    background-color: #71ac63;
    color: #FFF;
}

</style>
</head>
<body>
    <!-- Container -->
    <div id="menu-top">
        <!-- Header -->
        <div id="header" style="padding-bottom: 0px;">
            <div id="branding">
            <img src="{% static "/site-wide/logo-large-white.png" %}" width="300px">
            </div>
        </div>
    </div>
    <div class="recipe">
        <h1>Recipes</h1>
        <select id="skus">
            <option selected disabled="true">Select a Product</option>
            {% for s in skus %}
                <option value="{{s.id}}">{{s.description}} ({{s.sku}})</option>
            {% endfor %}
        </select>
    </div>
    <div id="myGrid" class="ag-theme-alpine" style="width: 100%; height: 100%;">
    </div>
</body>
<script>
    function currencyFormatter(currency) {
        var sansDec = parseFloat(currency.value).toFixed(2);
        var formatted = sansDec.replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ",");
        return '$' + `${formatted}`;
    }

    function numberFormatter(currency) {
        var sansDec = parseFloat(currency.value).toFixed(4);
        var formatted = sansDec.replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ",");
        return `${formatted}`;
    }

    // function onPinnedRowBottomCount() {
    //     var footerRowsToFloat = document.getElementById('bottom-row-count').value;
    //     var count = Number(footerRowsToFloat);
    //     var rows = createData(count, 'Bottom');
    //     gridOptions.api.setPinnedBottomRowData(rows);
    // }

    $(document).ready(function(){
        var $sku = $("#skus");
        $sku.select2();
        $sku.on("change", function (e) { 
            console.log($sku.val())

            agGrid
                .simpleHttpRequest({
                    url: '/operations/get-recipe/' + $sku.val(),
                })
                .then(function (data) {
                    gridOptions.api.setRowData(data);
                });
        });
    })

    var gridOptions = {
        columnDefs: [
            { field: 'SKU', width: 300,},
            { field: 'Description', width: 450,},
            { 
                field: 'Quantity Needed',
                width: 150,
                type: 'numberColumn',
                valueFormatter: numberFormatter
            },
            { field: 'Unit of Measure', width: 150,},
            {
                field: 'Cost',
                width: 150,
                valueFormatter: currencyFormatter
            },
        ],
        defaultColDef: {
            // flex: 1,
            // minWidth: 110,
            editable: true,
            resizable: true,
        },
        rowData: [],
        // onRowEditingStarted: function (event) {
        //     console.log('never called - not doing row editing');
        // },
        // onRowEditingStopped: function (event) {
        //     console.log('never called - not doing row editing');
        // },
        // onCellEditingStarted: function (event) {
        //     console.log('cellEditingStarted');
        // },
        // onCellEditingStopped: function (event) {
        //     console.log('cellEditingStopped');
        // },
        // onFirstDataRendered: onFirstDataRendered,
        enableRangeSelection: true,
        // getRowStyle: function (params) {
        //     if (params.node.rowPinned) {
        //     return { 'font-weight': 'bold' };
        //     }
        // },
        // pinnedBottomRowData: createData(1, 'Bottom'),
        // components: {
        //     customPinnedRowRenderer: CustomPinnedRowRenderer,
        // },

    };

    var gridDiv = document.querySelector('#myGrid');
    new agGrid.Grid(gridDiv, gridOptions);
    gridOptions.api.setDomLayout('autoHeight');

    // agGrid
    //             .simpleHttpRequest({
    //                 url: '/operations/get-recipe/691',
    //             })
    //             .then(function (data) {
    //                 gridOptions.api.setRowData(data);
    //             });

</script>
</html>